<!-- This file is used to generate the installer for the qala cli -->
<!-- The installer is generated using the WiX Toolset -->
<!-- In order to generate the .msi file execute in the command line: wix build .\qala.wxs -->
<!-- The Wix toolset must be installed: dotnet tool install /-/-global wix -->
<!-- Confirm Wix install: wix /-/-version -->
<?define name = "qala installer"?> <!-- Name of the installer -->
<?define exe = "Qala.Cli.exe"?> <!-- Executable name: generated by the dotnet publish -->
<?define path = "..\.releases\windows"?> <!-- Path to the executable -->
<?define silentArgs = "/VERYSILENT /NORESTART /SUPPRESSMSGBOXES /MERGETASKS=!runcode"?> <!-- Silent arguments for the installer -->
<?define version = "$(env.QALA_CLI_VERSION)"?> <!-- Version number of the app that needs to be set before the execution of wix toolset -->
<?define publisher = "QalaTechnologies"?> <!-- Company name -->
<?define guid = "07419927-af16-4cca-8a32-0b2b58de68f5"?> <!-- Generate a guid by executing the command line: [guid]::NewGuid().guid-->

<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
    <Package Name="$(var.name)" 
             Manufacturer="$(var.publisher)" 
             Version="$(var.version)"
             UpgradeCode="$(var.guid)" 
             Scope="perMachine">
        <Media Id="1" Cabinet="setup.cab" EmbedCab="yes" />
        <CustomAction 
            Id="run_exe" 
            Return="asyncWait" 
            Execute="commit" 
            ExeCommand="$(var.silentArgs)" 
            HideTarget="yes" 
            Impersonate="no"
            FileRef="executable" />
        <InstallExecuteSequence>
            <Custom Action="run_exe" After="InstallFiles" Condition="NOT Installed AND NOT REMOVE" />
        </InstallExecuteSequence>
        <StandardDirectory Id="TempFolder">
            <Directory Id="INSTALLLOCATION" Name="$(var.guid)">
                <Component Id="file" DiskId="1">
                    <File Id="executable" Name="$(var.exe)" Source="$(var.path)\$(var.exe)" />
                </Component>
            </Directory>
        </StandardDirectory>
        <Component Id="SetEnvironmentPath" Guid="$(var.guid)">
        <!-- Add your application directory to PATH -->
        <Environment Id="AddToPath"
                    Name="qala"
                    Value="$(var.path)\$(var.exe)"
                    Action="set"
                    Part="last"
                    Permanent="yes" />
        </Component>
        <Feature Id="Main" Title="Install Qala CLI">
            <ComponentRef Id="file" />
            <ComponentRef Id="SetEnvironmentPath" />
        </Feature>
    </Package>
</Wix>